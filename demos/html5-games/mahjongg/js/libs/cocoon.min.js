!function(){Cocoon=window.Cocoon?window.Cocoon:{},Cocoon.version="3.0.5",Cocoon.nativeAvailable=!!window.ext,Cocoon.extend=function(e,o){var n=e.prototype,t=function(){};t.prototype=o.prototype,e.prototype=new t,e.superclass=o.prototype,e.prototype.constructor=e,o.prototype.constructor===Object.prototype.constructor&&(o.prototype.constructor=o);for(var i in n)n.hasOwnProperty(i)&&(e.prototype[i]=n[i])},Cocoon.clone=function(e,o){if(null==e||"object"!=typeof e)return e;var n=[];for(var t in e)n.push(o.hasOwnProperty(t)?o[t]:e[t]);return n},Cocoon.callNative=function(e,o,n,t){if(Cocoon.nativeAvailable){var i=Array.prototype.slice.call(n);i.unshift(o);var a=ext[e],r=t?a.makeCallAsync:a.makeCall,c=r.apply(a,i),s=c;if("string"==typeof c)try{s=JSON.parse(c)}catch(l){console.log(l)}return s}},Cocoon.getObjectFromPath=function(e,o){for(var n=o.split("."),t=e,i=0,a=n.length;a>i;++i)t[n[i]]=t[n[i]]||void 0,t=t[n[i]];return t},Cocoon.EventHandler=function(e,o,n,t){return this.listeners=[],this.listenersOnce=[],this.chainFunction=t,this.addEventListener=function(i){if(t){var a=function(){t.call(this,arguments.callee.sourceListener,Array.prototype.slice.call(arguments))};i.CocoonEventHandlerChainFunction=a,a.sourceListener=i,i=a}var r=Cocoon.getObjectFromPath(Cocoon,o);if(r&&r.nativeAvailable)ext[e].addEventListener(n,i);else{var c=this.listeners.indexOf(i);0>c&&this.listeners.push(i)}},this.addEventListenerOnce=function(i){if(t){var a=function(){t(arguments.callee.sourceListener,Array.prototype.slice.call(arguments))};a.sourceListener=i,i=a}var r=Cocoon.getObjectFromPath(Cocoon,o);if(r.nativeAvailable)ext[e].addEventListenerOnce(n,i);else{var c=this.listeners.indexOf(i);0>c&&this.listenersOnce.push(i)}},this.removeEventListener=function(i){t&&(i=i.CocoonEventHandlerChainFunction,delete i.CocoonEventHandlerChainFunction);var a=Cocoon.getObjectFromPath(Cocoon,o);if(a.nativeAvailable)ext[e].removeEventListener(n,i);else{var r=this.listeners.indexOf(i);r>=0&&this.listeners.splice(r,1)}},this.removeEventListenerOnce=function(i){t&&(i=i.CocoonEventHandlerChainFunction,delete i.CocoonEventHandlerChainFunction);var a=Cocoon.getObjectFromPath(Cocoon,o);if(a.nativeAvailable)ext[e].removeEventListenerOnce(n,i);else{var r=this.listenersOnce.indexOf(i);r>=0&&this.listenersOnce.splice(r,1)}},this.notifyEventListeners=function(){var t=Cocoon.getObjectFromPath(Cocoon,o);if(t&&t.nativeAvailable)ext[e].notifyEventListeners(n);else{var i=Array.prototype.slice.call(arguments),a=Array.prototype.slice.call(this.listeners),r=Array.prototype.slice.call(this.listenersOnce),c=this;setTimeout(function(){for(var e=0;e<a.length;e++)a[e].apply(c,i);for(var e=0;e<r.length;e++)r[e].apply(c,i)},0),c.listenersOnce=[]}},this},Cocoon.define=function(e,o){for(var n="Cocoon."==e.substring(0,7)?e.substr(7):e,t=window.Cocoon,i=n.split("."),a=t,r=0;r<i.length;r++){var c=i[r];if(console.log(a[c]?"Updated namespace: - "+e:"Created namespace: "+e),a=a[c]=r==i.length-1?o(a[c]||{}):{},!a)throw"Unable to create class "+e}return!0},console.log("Created namespace: Cocoon")}(),Cocoon.define("Cocoon.Signal",function(e){"use strict";return e.createSignal=function(){this.handle=null,this.signals={},this.register=function(e,o){if(!e&&!o)throw new Error("Can't create signal "+(e||""));if(o.addEventListener)return this.signals[e]=o,!0;if(!o.addEventListener){this.signals[e]={};for(var n in o)o.hasOwnProperty(n)&&(this.signals[e][n]=o[n]);return!0}throw new Error("Can't create handler for "+e+" signal.")},this.expose=function(){return function(e,o,n){var t=!1;if(1===arguments.length){var i=this,a=function(e){this.signal=e};return a.prototype.remove=function(e){var o=i.signals[this.signal];o&&o.removeEventListener&&(o.removeEventListener.apply(i,[e]),i.signals[this.signal]=void 0)},new a(e)}if(n&&n.once&&(t=!0),!this.signals[e])throw new Error("The signal "+e+" does not exists.");var r=this.signals[e];if(r.addEventListener&&(t?r.addEventListenerOnce(function(){o.apply(this||window,arguments)}):r.addEventListener(function(){o.apply(this||window,arguments)})),!this.signals[e].addEventListener)for(var c in this.signals[e])if(this.signals[e].hasOwnProperty(c)){var r=this.signals[e][c];t?r.addEventListenerOnce(function(){this.clbk[this.name].apply(this||window,arguments)}.bind({name:c,clbk:o})):r.addEventListener(function(){this.clbk[this.name].apply(this||window,arguments)}.bind({name:c,clbk:o}))}}.bind(this)}},e}),Cocoon.define("Cocoon.App",function(e){e.nativeAvailable=!!window.ext&&!!window.ext.IDTK_APP,e.isBridgeAvailable=function(){if("boolean"===Cocoon.App.forward.nativeAvailable)return Cocoon.App.forward.nativeAvailable;var e=Cocoon.callNative("IDTK_APP","forwardAvailable",arguments);return e=!!e,Cocoon.App.forward.nativeAvailable=e,e},e.forward=function(e){return Cocoon.App.nativeAvailable&&Cocoon.App.isBridgeAvailable()?Cocoon.callNative("IDTK_APP","forward",arguments):navigator.isCocoonJS?void 0:"CocoonJS_App_ForCocoonJS_WebViewIFrame"==window.name?window.parent.eval(e):window.frames.CocoonJS_App_ForCocoonJS_WebViewIFrame.window.eval(e)},e.forwardAsync=function(e,o){return Cocoon.App.nativeAvailable&&Cocoon.App.isBridgeAvailable()?"undefined"!=typeof o?ext.IDTK_APP.makeCallAsync("forward",e,o):ext.IDTK_APP.makeCallAsync("forward",e):void setTimeout(function(){var n;"CocoonJS_App_ForCocoonJS_WebViewIFrame"==window.name?(n=window.parent.eval(e),"function"==typeof o&&o(n)):(n=window.parent.frames.CocoonJS_App_ForCocoonJS_WebViewIFrame.window.eval(e),"function"==typeof o&&o(n))},1)},e.load=function(e){if(Cocoon.App.nativeAvailable)return Cocoon.callNative("IDTK_APP","loadPath",arguments);if(!navigator.isCocoonJS){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status){var n;n=Cocoon.App.EmulatedWebViewIFrame?"window.Cocoon && window.Cocoon.App.onLoadInCocoonJSSucceed.notifyEventListeners('"+e+"');":"window.Cocoon && window.Cocoon.App.onLoadInTheWebViewSucceed.notifyEventListeners('"+e+"');",Cocoon.App.forwardAsync(n),window.location.href=e}else if(404===o.status){this.onreadystatechange=null;var n;n=Cocoon.App.EmulatedWebViewIFrame?"Cocoon && Cocoon.App.onLoadInCocoonJSFailed.notifyEventListeners('"+e+"');":"Cocoon && Cocoon.App.onLoadInTheWebViewFailed.notifyEventListeners('"+e+"');",Cocoon.App.forwardAsync(n)}},o.open("GET",e,!0),o.send()}},e.reload=function(){return Cocoon.App.nativeAvailable?Cocoon.callNative("IDTK_APP","reload",arguments):navigator.isCocoonJS?void 0:"CocoonJS_App_ForCocoonJS_WebViewIFrame"==window.name?window.parent.location.reload():window.parent.frames.CocoonJS_App_ForCocoonJS_WebViewIFrame.window.location.reload()},e.openURL=function(e){return Cocoon.App.nativeAvailable?Cocoon.callNative("IDTK_APP","openURL",arguments,!0):void(navigator.isCocoonJS||window.open(e,"_blank"))},e.exit=function(){return Cocoon.App.nativeAvailable?Cocoon.callNative("IDTK_APP","forceToFinish",arguments):void(navigator.isCocoonJS||window.close())},e.StorageType={APP_STORAGE:"APP_STORAGE",INTERNAL_STORAGE:"INTERNAL_STORAGE",EXTERNAL_STORAGE:"EXTERNAL_STORAGE",TEMPORARY_STORAGE:"TEMPORARY_STORAGE"},e.onSuspended=new Cocoon.EventHandler("IDTK_APP","App","onsuspended"),e.onActivated=new Cocoon.EventHandler("IDTK_APP","App","onactivated"),e.onSuspending=new Cocoon.EventHandler("IDTK_APP","App","onsuspending"),e.onMemoryWarning=new Cocoon.EventHandler("IDTK_APP","App","onmemorywarning");var o=new Cocoon.Signal.createSignal;return o.register("suspended",e.onSuspended),o.register("activated",e.onActivated),o.register("suspending",e.onSuspending),o.register("memorywarning",e.onMemoryWarning),e.on=o.expose(),e}),Cocoon.define("Cocoon.App",function(e){function o(){var e=Cocoon.App.EmulatedWebView;if(!e){e=document.createElement("div"),e.setAttribute("id","CocoonJS_App_ForCocoonJS_WebViewDiv"),e.style.width=0,e.style.height=0,e.style.position="absolute",e.style.left=0,e.style.top=0,e.style.backgroundColor="transparent",e.style.border="0px solid #000";var o=document.createElement("IFRAME");o.setAttribute("id","CocoonJS_App_ForCocoonJS_WebViewIFrame"),o.setAttribute("name","CocoonJS_App_ForCocoonJS_WebViewIFrame"),o.style.width=0,o.style.height=0,o.frameBorder=0,o.allowtransparency=!0,e.appendChild(o),Cocoon.App.EmulatedWebView=e,Cocoon.App.EmulatedWebViewIFrame=o,document.body||(document.body=document.createElement("body")),document.body.appendChild(Cocoon.App.EmulatedWebView)}}e.pause=function(){return Cocoon.App.nativeAvailable?Cocoon.callNative("IDTK_APP","pause",arguments):void 0},e.resume=function(){return Cocoon.App.nativeAvailable?Cocoon.callNative("IDTK_APP","resume",arguments):void 0},e.loadInTheWebView=function(e){if(navigator.isCocoonJS&&Cocoon.App.nativeAvailable)Cocoon.callNative("IDTK_APP","loadInTheWebView",arguments);else{var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState)if(n.status>=200&&n.status<=299||0===n.status){o();var t=function(){Cocoon.App.onLoadInTheWebViewSucceed.notifyEventListeners(e),Cocoon.App.EmulatedWebViewIFrame.removeEventListener("load",t)};Cocoon.App.EmulatedWebViewIFrame.addEventListener("load",t),Cocoon.App.EmulatedWebViewIFrame.contentWindow.location.href=e}else this.onreadystatechange=null,Cocoon.App.onLoadInTheWebViewFailed.notifyEventListeners(e)},n.open("GET",e,!0),n.send()}},e.reloadWebView=function(){Cocoon.App.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_APP","reloadWebView",arguments):(o(),Cocoon.App.EmulatedWebViewIFrame.contentWindow.location.reload())},e.showTheWebView=function(e,n,t,i){Cocoon.App.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_APP","showTheWebView",arguments):(o(),Cocoon.App.EmulatedWebViewIFrame.style.width=(t?t/window.devicePixelRatio:window.innerWidth)+"px",Cocoon.App.EmulatedWebViewIFrame.style.height=(i?i/window.devicePixelRatio:window.innerHeight)+"px",Cocoon.App.EmulatedWebView.style.left=(e?e:0)+"px",Cocoon.App.EmulatedWebView.style.top=(n?n:0)+"px",Cocoon.App.EmulatedWebView.style.width=(t?t/window.devicePixelRatio:window.innerWidth)+"px",Cocoon.App.EmulatedWebView.style.height=(i?i/window.devicePixelRatio:window.innerHeight)+"px",Cocoon.App.EmulatedWebView.style.display="block")},e.hideTheWebView=function(){if(Cocoon.App.nativeAvailable&&navigator.isCocoonJS){var e="ext.IDTK_APP.makeCall('hide');";return Cocoon.App.forwardAsync(e)}o(),Cocoon.App.EmulatedWebView.style.display="none"},e.exitCallback=function(e){navigator.isCocoonJS&&Cocoon.App.nativeAvailable&&(window.onidtkappfinish=e)},e.forwardedEventFromTheWebView=function(e,o){var n=JSON.parse(o);n.target=window;var t=new Event(e);for(var i in n)t[i]=n[i];t.target=window,window.dispatchEvent(t);for(var a=document.getElementsByTagName("canvas"),r=0;r<a.length;r++)t.target=a[r],a[r].dispatchEvent(t)},e.onLoadInTheWebViewSucceed=new Cocoon.EventHandler("IDTK_APP","App","forwardpageload"),e.onLoadInTheWebViewFailed=new Cocoon.EventHandler("IDTK_APP","App","forwardpagefail");var n=new Cocoon.Signal.createSignal;return n.register("load",{success:e.onLoadInTheWebViewSucceed,error:e.onLoadInTheWebViewFailed}),e.WebView=Cocoon.WebView||{},e.WebView.on=n.expose(),e}),Cocoon.define("Cocoon.Utils",function(e){"use strict";return e.logMemoryInfo=function(){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_APP","logMemoryInfo",arguments):void 0},e.textureReduction=function(){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_APP","setDefaultTextureReducerThreshold",arguments):void 0},e.markAsMusic=function(){return Cocoon.nativeAvailable?Cocoon.callNative("IDTK_APP","addForceMusic",arguments):void 0},e.captureScreen=function(){return Cocoon.nativeAvailable?Cocoon.callNative("IDTK_APP","captureScreen",arguments):void 0},e.captureScreenAsync=function(){Cocoon.nativeAvailable&&Cocoon.callNative("IDTK_APP","captureScreen",arguments,!0)},e.setAntialias=function(){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_APP","setDefaultAntialias",arguments):void 0},e.setWebGLEnabled=function(){return Cocoon.nativeAvailable?Cocoon.callNative("IDTK_APP","setDefaultAntialias",arguments):void 0},e.setNPOTEnabled=function(e){return Cocoon.nativeAvailable&&navigator.isCocoonJS?window.ext.IDTK_APP.makeCall("setNPOTEnabled",e):void 0},e.setMaxMemory=function(e){return Cocoon.nativeAvailable&&navigator.isCocoonJS?window.ext.IDTK_APP.makeCall("setMaxMemory",e):void 0},e.CaptureType={EVERYTHING:0,COCOONJS_GL_SURFACE:1,JUST_SYSTEM_VIEWS:2},e.existsPath=function(){return Cocoon.nativeAvailable?Cocoon.callNative("IDTK_APP","existsPath",arguments):!1},e.setTextCacheSize=function(){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_APP","setTextCacheSize",arguments):void 0},e}),Cocoon.define("Cocoon.Dialog",function(e){"use strict";return e.keyboardType={TEXT:"text",NUMBER:"num",PHONE:"phone",EMAIL:"email",URL:"url"},e.prompt=function(e,o){if(!o)throw"Callback missing for Cocoon.Dialog.prompt();";var n=Cocoon.Dialog.keyboardType.TEXT;switch(e.type){case Cocoon.Dialog.keyboardType.TEXT:n=Cocoon.Dialog.keyboardType.TEXT;break;case Cocoon.Dialog.keyboardType.NUMBER:n=Cocoon.Dialog.keyboardType.NUMBER;break;case Cocoon.Dialog.keyboardType.PHONE:n=Cocoon.Dialog.keyboardType.PHONE;break;case Cocoon.Dialog.keyboardType.EMAIL:n=Cocoon.Dialog.keyboardType.EMAIL;break;case Cocoon.Dialog.keyboardType.URL:n=Cocoon.Dialog.keyboardType.URL}var t={title:"",message:"",text:"",type:n,cancelText:"Cancel",confirmText:"Ok",secureText:!1},i=Cocoon.clone(t,e),a=function(){Cocoon.Dialog.onTextDialogCancelled.removeEventListener(r),Cocoon.Dialog.onTextDialogFinished.removeEventListener(a),o.success.apply(window,Array.prototype.slice.call(arguments))},r=function(){Cocoon.Dialog.onTextDialogCancelled.removeEventListener(r),Cocoon.Dialog.onTextDialogFinished.removeEventListener(a),o.cancel.apply(window,Array.prototype.slice.call(arguments))};return Cocoon.Dialog.onTextDialogCancelled.addEventListener(r),Cocoon.Dialog.onTextDialogFinished.addEventListener(a),Cocoon.App.nativeAvailable?Cocoon.callNative("IDTK_APP","showTextDialog",i,!0):void setTimeout(function(){var e=prompt(t.message,t.text),o=e?Cocoon.Dialog.onTextDialogFinished:Cocoon.Dialog.onTextDialogCancelled;o.notifyEventListeners(e)},0)},e.confirm=function(e,o){if(!o)throw"Callback missing for Cocoon.Dialog.confirm();";var n={title:"",message:"",cancelText:"Cancel",confirmText:"Ok"},t=Cocoon.clone(n,e),i=function(){Cocoon.Dialog.onMessageBoxDenied.removeEventListenerOnce(a),o(!0)},a=function(){Cocoon.Dialog.onMessageBoxConfirmed.removeEventListenerOnce(i),o(!1)};return Cocoon.Dialog.onMessageBoxDenied.addEventListenerOnce(a),Cocoon.Dialog.onMessageBoxConfirmed.addEventListenerOnce(i),Cocoon.nativeAvailable?Cocoon.callNative("IDTK_APP","showMessageBox",t,!0):void setTimeout(function(){var e=confirm(n.message),o=e?Cocoon.Dialog.onMessageBoxConfirmed:Cocoon.Dialog.onMessageBoxDenied;o.notifyEventListeners()},0)},e.showKeyboard=function(e,o){e=e||{},e.type=e.type||Cocoon.Dialog.keyboardType.TEXT;var n=o&&o.insertText,t=o&&o.deleteBackward,i=o&&o.done,a=o&&o.cancel;Cocoon.nativeAvailable&&Cocoon.callNative("IDTK_APP","showKeyboard",[e,n,t,i,a],!0)},e.dismissKeyboard=function(){Cocoon.nativeAvailable&&Cocoon.callNative("IDTK_APP","dismissKeyboard",[],!0)},e.onTextDialogFinished=new Cocoon.EventHandler("IDTK_APP","App","ontextdialogfinish"),e.onTextDialogCancelled=new Cocoon.EventHandler("IDTK_APP","App","ontextdialogcancel"),e.onMessageBoxConfirmed=new Cocoon.EventHandler("IDTK_APP","App","onmessageboxconfirmed"),e.onMessageBoxDenied=new Cocoon.EventHandler("IDTK_APP","App","onmessageboxdenied"),e}),Cocoon.define("Cocoon.WebView",function(e){return"undefined"==typeof Cocoon||null===Cocoon?e:"undefined"==typeof Cocoon.App||null===Cocoon.App?e:navigator.isCocoonJS?e:(e.show=function(e,o,n,t){if(Cocoon.App.nativeAvailable)return Cocoon.callNative("IDTK_APP","show",arguments);var i=window.parent.document.getElementById("CocoonJS_App_ForCocoonJS_WebViewDiv");i.style.left=(e?e:i.style.left)+"px",i.style.top=(o?o:i.style.top)+"px",i.style.width=(n?n/window.devicePixelRatio:window.parent.innerWidth)+"px",i.style.height=(t?t/window.devicePixelRatio:window.parent.innerHeight)+"px",i.style.display="block";var a=window.parent.document.getElementById("CocoonJS_App_ForCocoonJS_WebViewIFrame");a.style.width=(n?n/window.devicePixelRatio:window.parent.innerWidth)+"px",a.style.height=(t?t/window.devicePixelRatio:window.parent.innerHeight)+"px"},e.hide=function(){return Cocoon.App.nativeAvailable?Cocoon.callNative("IDTK_APP","hide",arguments):void(window.parent.document.getElementById("CocoonJS_App_ForCocoonJS_WebViewDiv").style.display="none")},e.loadInCocoon=function(e,o,n){if(Cocoon.App.nativeAvailable){var t="ext.IDTK_APP.makeCall('loadPath'";return"undefined"!=typeof e&&(t+=", '"+e+"'","undefined"!=typeof n&&(t+=", '"+n+"'")),t+=");",Cocoon.App.forwardAsync(t)}Cocoon.App.forwardAsync("Cocoon.App.load('"+e+"');")},e.reloadCocoonJS=function(){return Cocoon.App.nativeAvailable?Cocoon.App.forwardAsync("ext.IDTK_APP.makeCall('reload');"):void(navigator.isCocoonJS||window.parent.location.reload())},window.addEventListener("load",function(){function e(e,n){var t,i,a={};for(var t in n)i=o.indexOf(t),i>=0&&(a[t]=n[t]);var r="Cocoon && Cocoon.App && Cocoon.App.forwardedEventFromTheWebView && Cocoon.App.forwardedEventFromTheWebView("+JSON.stringify(e)+", '"+JSON.stringify(a)+"');";Cocoon.App.forward(r)}if(!Cocoon.App.nativeAvailable&&"CocoonJS_App_ForCocoonJS_WebViewIFrame"==window.name){Cocoon.App.forwardEventsToCocoonJSEnabled=!1;var o=["timeStamp","button","type","x","y","pageX","pageY","clientX","clientY","offsetX","offsetY"],n=["dblclick","touchmove","mousemove","touchend","touchcancel","mouseup","touchstart","mousedown","release","dragleft","dragright","swipeleft","swiperight"];for(i=0;i<n.length;i++)window.addEventListener(n[i],function(o){return function(n){Cocoon.App.forwardEventsToCocoonJSEnabled&&e(o,n)}}(n[i]))}}),e.onLoadInCocoonJSSucceed=new Cocoon.EventHandler("IDTK_APP","App","forwardpageload"),e.onLoadInCocoonJSFailed=new Cocoon.EventHandler("IDTK_APP","App","forwardpagefail"),e)}),Cocoon.define("Cocoon.Proxify",function(e){"use strict";return e.getKeyForValueInDictionary=function(e,o){var n=null;for(var t in e)if(e[t]===o){n=t;break}return n},e.setupOriginProxyType=function(o,n,t,i){if(Cocoon.nativeAvailable){if(!o)throw"The given typeName must be valid.";if(!n&&!t&&!i)throw"There is no point on setting up a proxy for no attributes, functions nor eventHandlers.";n=n?n:[],t=t?t:[],i=i?i:[];var a=window,r="Cocoon.Proxify.setupDestinationProxyType("+JSON.stringify(o)+", "+JSON.stringify(i)+");";Cocoon.App.forward(r);var c=a[o];a[o]=function(){var e=this;this._cocoonjs_proxy_object_data={};var r="Cocoon.Proxify.newDestinationProxyObject("+JSON.stringify(o)+");";this._cocoonjs_proxy_object_data.id=Cocoon.App.forward(r),this._cocoonjs_proxy_object_data.eventHandlers={},this._cocoonjs_proxy_object_data.typeName=o,this._cocoonjs_proxy_object_data.eventListeners={},a[o]._cocoonjs_proxy_type_data.proxyObjects[this._cocoonjs_proxy_object_data.id]=this;for(var c=0;c<n.length;c++)!function(n){e.__defineSetter__(n,function(t){var i="Cocoon.Proxify.setDestinationProxyObjectAttribute("+JSON.stringify(o)+", "+e._cocoonjs_proxy_object_data.id+", "+JSON.stringify(n)+", "+JSON.stringify(t)+");";return Cocoon.App.forward(i)}),e.__defineGetter__(n,function(){var t="Cocoon.Proxify.getDestinationProxyObjectAttribute("+JSON.stringify(o)+", "+e._cocoonjs_proxy_object_data.id+", "+JSON.stringify(n)+");";return Cocoon.App.forward(t)})}(n[c]);for(var c=0;c<t.length;c++)!function(n){e[n]=function(){var e=Array.prototype.slice.call(arguments);e.unshift(n),e.unshift(this._cocoonjs_proxy_object_data.id),e.unshift(o);for(var t="Cocoon.Proxify.callDestinationProxyObjectFunction(",i=0;i<e.length;i++)t+=(1!==i?JSON.stringify(e[i]):e[i])+(i<e.length-1?", ":"");t+=");";var a=Cocoon.App.forwardAsync(t);return a}}(t[c]);for(var c=0;c<i.length;c++)!function(o){e.__defineSetter__(o,function(n){e._cocoonjs_proxy_object_data.eventHandlers[o]=n}),e.__defineGetter__(o,function(){return e._cocoonjs_proxy_object_data.eventHandlers[o]})}(i[c]);return e.addEventListener=function(o,n){var t=!0,i=e._cocoonjs_proxy_object_data.eventListeners[o];if(i)t=i.indexOf(n)<0;else{i=[],e._cocoonjs_proxy_object_data.eventListeners[o]=i;var a="Cocoon.Proxify.addDestinationProxyObjectEventListener("+JSON.stringify(e._cocoonjs_proxy_object_data.typeName)+", "+e._cocoonjs_proxy_object_data.id+", "+JSON.stringify(o)+");";Cocoon.App.forwardAsync(a)}t&&i.push(n)},e.removeEventListener=function(o,n){var t=e._cocoonjs_proxy_object_data.eventListeners[o];if(t){var i=t.indexOf(n);i>=0&&t.splice(i,1)}},this},a[o]._cocoonjs_proxy_type_data={originalType:c,proxyObjects:[]},a[o]._cocoonjs_proxy_type_data.deleteProxyObject=function(n){var t=e.getKeyForValueInDictionary(this.proxyObjects,n);if(t){var i="Cocoon.Proxify.deleteDestinationProxyObject("+JSON.stringify(o)+", "+n._cocoonjs_proxy_object_data.id+");";Cocoon.App.forwardAsync(i),n._cocoonjs_proxy_object_data=null,delete this.proxyObjects[t]}},a[o]._cocoonjs_proxy_type_data.callProxyObjectEventHandler=function(e,o){var n=this.proxyObjects[e],t=n._cocoonjs_proxy_object_data.eventHandlers[o];t&&t({target:n})},a[o]._cocoonjs_proxy_type_data.callProxyObjectEventListeners=function(e,o){for(var n=this.proxyObjects[e],t=n._cocoonjs_proxy_object_data.eventListeners[o].slice(),i=0;i<t.length;i++)t[i]({target:n})}}},e.takedownOriginProxyType=function(e){if(Cocoon.App.nativeAvailable){var o=window;o[e]&&o[e]._cocoonjs_proxy_type_data&&(o[e]=o[e]._cocoonjs_proxy_type_data.originalType)}},e.deleteOriginProxyObject=function(e){if(Cocoon.App.nativeAvailable){var o=window;e&&e._cocoonjs_proxy_object_data&&o[e._cocoonjs_proxy_object_data.typeName]._cocoonjs_proxy_type_data.deleteProxyObject(e)}},e.callOriginProxyObjectEventHandler=function(e,o,n){if(Cocoon.App.nativeAvailable){var t=window;t[e]._cocoonjs_proxy_type_data.callProxyObjectEventHandler(o,n)}},e.callOriginProxyObjectEventListeners=function(e,o,n){if(Cocoon.App.nativeAvailable){var t=window;t[e]._cocoonjs_proxy_type_data.callProxyObjectEventListeners(o,n)}},e.setupDestinationProxyType=function(e,o){if(Cocoon.App.nativeAvailable){var n=window;n[e]._cocoonjs_proxy_type_data={nextId:0,proxyObjects:{},eventHandlerNames:o}}},e.takedownDestinationProxyType=function(e){if(Cocoon.App.nativeAvailable){var o=window;parent[e]&&o[e]._cocoonjs_proxy_type_data&&delete o[e]._cocoonjs_proxy_type_data}},e.newDestinationProxyObject=function(e){if(Cocoon.App.nativeAvailable){var o=window,n=new o[e];n._cocoonjs_proxy_object_data={},n._cocoonjs_proxy_object_data.typeName=e;var t=o[e]._cocoonjs_proxy_type_data.nextId;o[e]._cocoonjs_proxy_type_data.proxyObjects[t]=n,n._cocoonjs_proxy_object_data.id=t,o[e]._cocoonjs_proxy_type_data.nextId++;for(var i=0;i<o[e]._cocoonjs_proxy_type_data.eventHandlerNames.length;i++)!function(e){n[e]=function(){var o=this,n="Cocoon.App.callOriginProxyObjectEventHandler("+JSON.stringify(o._cocoonjs_proxy_object_data.typeName)+", "+o._cocoonjs_proxy_object_data.id+", "+JSON.stringify(e)+");";Cocoon.App.forwardAsync(n)}}(o[e]._cocoonjs_proxy_type_data.eventHandlerNames[i]);return n._cocoonjs_proxy_object_data.eventListeners={},t}},e.callDestinationProxyObjectFunction=function(e,o,n){if(Cocoon.App.nativeAvailable){var t=window,i=Array.prototype.slice.call(arguments);i.splice(0,3);var a=t[e]._cocoonjs_proxy_type_data.proxyObjects[o],r=a[n].apply(a,i);return r}},e.setDestinationProxyObjectAttribute=function(e,o,n,t){if(Cocoon.App.nativeAvailable){var i=window,a=i[e]._cocoonjs_proxy_type_data.proxyObjects[o];a[n]=t}},e.getDestinationProxyObjectAttribute=function(e,o,n){if(Cocoon.App.nativeAvailable){var t=window,i=t[e]._cocoonjs_proxy_type_data.proxyObjects[o];return i[n]}},e.deleteDestinationProxyObject=function(e,o){if(Cocoon.App.nativeAvailable){var n=window;delete n[e]._cocoonjs_proxy_type_data.proxyObjects[o]}},e.addDestinationProxyObjectEventListener=function(e,o,n){if(Cocoon.App.nativeAvailable){var t=window,i=t[e]._cocoonjs_proxy_type_data.proxyObjects[o],a=function(){var e=this,o="Cocoon.Proxify.callOriginProxyObjectEventListeners("+JSON.stringify(e._cocoonjs_proxy_object_data.typeName)+", "+e._cocoonjs_proxy_object_data.id+", "+JSON.stringify(n)+");";Cocoon.App.forwardAsync(o)};i._cocoonjs_proxy_object_data.eventListeners[n]=a,i.addEventListener(n,a)}},e.xhr=function(){var e=["timeout","withCredentials","upload","status","statusText","responseType","response","responseText","responseXML","readyState"],o=["open","setRequestHeader","send","abort","getResponseHeader","getAllResponseHeaders","overrideMimeType"],n=["onloadstart","onprogress","onabort","onerror","onload","ontimeout","onloadend","onreadystatechange"];Cocoon.Proxify.setupOriginProxyType("XMLHttpRequest",e,o,n)},e.audio=function(){var e=["src","loop","volume","preload"],o=["play","pause","load","canPlayType"],n=["onended","oncanplay","oncanplaythrough","onerror"];Cocoon.Proxify.setupOriginProxyType("Audio",e,o,n)},e.console=function(){if(Cocoon.nativeAvailable){"undefined"==typeof Cocoon.originalConsole&&(Cocoon.originalConsole=window.console);for(var e=["log","error","info","debug","warn"],o={},n=0;n<e.length;n++)o[e[n]]=function(){return function(e){try{var o="Proxified log: "+JSON.stringify(e);Cocoon.originalConsole.log(o),ext.IDTK_APP.makeCallAsync("forward",o)}catch(n){console.log("Proxified log: "+n)}}}(e[n]);o.assert||(o.assert=function(){if(arguments.length>0&&!arguments[0]){var e="Assertion failed: "+(arguments.length>1?arguments[1]:"");o.error(e)}}),window.console=o}},e.deproxifyConsole=function(){!window.navigator.isCocoonJS&&Cocoon.nativeAvailable&&"undefined"!=typeof Cocoon.originalConsole&&(window.console=Cocoon.originalConsole,Cocoon.originalConsole=void 0)},e}),Cocoon.define("Cocoon.Device",function(e){"use strict";return e.DeviceInfo={os:null,version:null,dpi:null,brand:null,model:null,imei:null,platformId:null,odin:null,openudid:null},e.getDeviceId=function(){return Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("getDeviceId"):void 0},e.getDeviceInfo=function(){return Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("getDeviceInfo"):void 0},e.getOrientation=function(){return Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("getPreferredOrientation"):0},e.setOrientation=function(e){Cocoon.nativeAvailable&&window.ext.IDTK_APP.makeCall("setPreferredOrientation",e)},e.Orientations={PORTRAIT:1,PORTRAIT_UPSIDE_DOWN:2,LANDSCAPE_LEFT:4,LANDSCAPE_RIGHT:8,LANDSCAPE:12,BOTH:15},e.autoLock=function(){return Cocoon.nativeAvailable?Cocoon.callNative("IDTK_APP","setAutoLockEnabled",arguments):void 0},e}),Cocoon.define("Cocoon.Motion",function(e){"use strict";return e.nativeAvailable=Cocoon.nativeAvailable,e.setAccelerometerInterval=function(e){return Cocoon.Motion.nativeAvailable?window.ext.IDTK_APP.makeCall("setAccelerometerUpdateIntervalInSeconds",e):void 0},e.getAccelerometerInterval=function(){return Cocoon.Motion.nativeAvailable?window.ext.IDTK_APP.makeCall("getAccelerometerUpdateIntervalInSeconds"):void 0},e.setGyroscopeInterval=function(e){return Cocoon.Motion.nativeAvailable?window.ext.IDTK_APP.makeCall("setGyroscopeUpdateIntervalInSeconds",e):void 0},e.getGyroscopeInterval=function(){Cocoon.Motion.nativeAvailable&&window.ext.IDTK_APP.makeCall("getGyroscopeUpdateIntervalInSeconds")},e}),Cocoon.define("Cocoon.Touch",function(e){return e.addADivToDisableInput=function(){var e=document.createElement("div");e.id="CocoonJSInputBlockingDiv",e.style.left=0,e.style.top=0,e.style.width="100%",e.style.height="100%",e.style.position="absolute",e.style.backgroundColor="transparent",e.style.border="0px solid #000",e.style.zIndex=999999999,document.body.appendChild(e)},e.removeTheDivToEnableInput=function(){var e=document.getElementById("CocoonJSInputBlockingDiv");e&&document.body.removeChild(e)},e.disable=function(){Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("disableTouchLayer","CocoonJSView"):navigator.isCocoonJS||Cocoon.App.EmulatedWebViewIFrame||(Cocoon.App.forwardEventsToCocoonJSEnabled=!1,Cocoon.App.forwardAsync("Cocoon && Cocoon.Touch && Cocoon.Touch.disable();"))},e.enable=function(){Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("enableTouchLayer","CocoonJSView"):navigator.isCocoonJS||Cocoon.App.EmulatedWebViewIFrame||(Cocoon.App.forwardEventsToCocoonJSEnabled=!0,Cocoon.App.forwardAsync("Cocoon && Cocoon.Touch && Cocoon.Touch.enable();"))},e.disableInWebView=function(){Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("disableTouchLayer","WebView"):navigator.isCocoonJS||(Cocoon.App.EmulatedWebViewIFrame?Cocoon.App.forwardAsync("Cocoon && Cocoon.Touch && Cocoon.Touch.disableInWebView();"):Cocoon.Touch.addADivToDisableInput())},e.enableInWebView=function(){Cocoon.nativeAvailable?window.ext.IDTK_APP.makeCall("enableTouchLayer","WebView"):navigator.isCocoonJS||(Cocoon.App.EmulatedWebViewIFrame?Cocoon.Touch.forwardAsync("Cocoon && Cocoon.Touch && Cocoon.Touch.enableInWebView();"):Cocoon.Touch.removeTheDivToEnableInput())},e}),Cocoon.define("Cocoon.Widget",function(e){"use strict";return e.WebDialog=function(){if(Cocoon.App.nativeAvailable)this.webDialogID=window.ext.IDTK_APP.makeCall("createWebDialog");else{var e=document.createElement("iframe");e.id="CocoonJSWebDialogIFrame",e.name="CocoonJSWebDialogIFrame",e.style.cssText="position:fixed;left:0;top:0;bottom:0;right:0; width:100%; height:100%;margin:0;padding:0;";var o=this;e.onload=function(){o.iframeloaded=!0;var e="Cocoon = {}; Cocoon.Widget = {}; Cocoon.Widget.WebDialog = {}; Cocoon.Widget.WebDialog.close = function(){   window.parent.CocoonJSCloseWebDialog();};";o.evalIframe(e);for(var n=0;n<o.pendingEvals.length;++n)o.evalIframe(o.pendingEvals[n]);o.pendingEvals=[]},e.onerror=function(){o.close()},this.iframe=e,this.pendingEvals=[],window.CocoonJSCloseWebDialog=function(){o.close()}}},e.WebDialog.prototype={show:function(e,o){return this.closeCallback=function(){Cocoon.Touch.enable(),o&&o()},Cocoon.App.nativeAvailable?(Cocoon.Touch.disable(),window.ext.IDTK_APP.makeCallAsync("showWebDialog",this.webDialogID,e,this.closeCallback)):(this.iframe.src=e,void document.body.appendChild(this.iframe))},close:function(){return Cocoon.App.nativeAvailable?window.ext.IDTK_APP.makeCallAsync("closeWebDialog",this.webDialogID):(this.iframe.parentNode&&this.iframe.parentNode.removeChild(this.iframe),void(this.closeCallback&&this.closeCallback()))},evalIframe:function(e){window.frames.CocoonJSWebDialogIFrame.eval(e)},eval:function(e){return Cocoon.App.nativeAvailable?window.ext.IDTK_APP.makeCallAsync("evalWebDialog",this.webDialogID,e):void(this.iframeloaded?this.evalIframe(e):this.pendingEvals.push(e))}},e}),Cocoon.define("Cocoon.Camera",function(e){return navigator.getUserMedia_=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,e.CameraType={FRONT:"FRONT",BACK:"BACK"},e.CaptureFormatType={JPEG:"JPEG",RGB_565:"RGB_565",NV21:"NV21",NV16:"NV16",YUY2:"YUY2",YV12:"YV12",BGRA32:"32BGRA"},e.CameraInfo={cameraIndex:0,cameraType:e.CameraType.BACK,supportedVideoSizes:[],supportedVideoFrameRates:[],supportedVideoCaptureImageFormats:[]},e.getNumberOfCameras=function(){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_SRV_CAMERA","getNumberOfCameras",arguments):navigator.getUserMedia_?1:0},e.getAllCamerasInfo=function(){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_SRV_CAMERA","getAllCamerasInfo",arguments):void 0},e.getCameraInfoByIndex=function(){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_SRV_CAMERA","getCameraInfoByIndex",arguments):void 0},e.getCameraInfoByType=function(){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_SRV_CAMERA","getCameraInfoByType",arguments):void 0},e.start=function(e){if(!Boolean(e.success)||!Boolean(e.error))throw new Error("Missing callbacks for Cocoon.Camera.start();");
if(Cocoon.nativeAvailable){var o={cameraIndex:0,width:50,height:50,frameRate:25},n=Cocoon.clone(o,e),t=Cocoon.callNative("IDTK_SRV_CAMERA","startCapturing",n);Boolean(t)?e.success(t):e.error(!1)}else navigator.getUserMedia_({video:!0,audio:!1},function(o){e.success(o)},function(o){e.error(o)})},e.stop=function(){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_SRV_CAMERA","stopCapturing",arguments):void 0},e.isCapturing=function(){return Cocoon.nativeAvailable&&navigator.isCocoonJS?Cocoon.callNative("IDTK_SRV_CAMERA","isCapturing",arguments):void 0},e}),Cocoon.define("Cocoon.Ad",function(e){"use strict";e.nativeAvailable=!!Cocoon.nativeAvailable&&!!window.ext.IDTK_SRV_AD,e.BannerLayout={TOP_CENTER:"TOP_CENTER",BOTTOM_CENTER:"BOTTOM_CENTER"},e.Rectangle=function(e,o,n,t){this.x=e,this.y=o,this.width=n,this.height=t},e.Banner=function(e){if("number"!=typeof e)throw"The given ad ID is not a number.";this.id=e;var o=this;this.onBannerShown=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannershow",function(e,n){o.id===n[0]&&e()}),this.onBannerHidden=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannerhide",function(e,n){o.id===n[0]&&e()}),this.onBannerReady=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannerready",function(e,n){o.id===n[0]&&e(n[1],n[2])});var n=new Cocoon.Signal.createSignal;n.register("ready",this.onBannerReady),n.register("shown",this.onBannerShown),n.register("hidden",this.onBannerHidden),this.on=n.expose()},e.Banner.prototype={showBanner:function(){Cocoon.Ad.nativeAvailable&&Cocoon.callNative("IDTK_SRV_AD","showBanner",[this.id],!0)},hideBanner:function(){Cocoon.Ad.nativeAvailable&&Cocoon.callNative("IDTK_SRV_AD","hideBanner",[this.id],!0)},load:function(){Cocoon.Ad.nativeAvailable&&Cocoon.callNative("IDTK_SRV_AD","refreshBanner",[this.id],!0)},getRectangle:function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","getRectangle",[this.id]):void 0},setRectangle:function(e){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","setRectangle",[this.id,e]):void 0},setBannerLayout:function(e){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","setBannerLayout",[this.id,e]):void 0}},e.Interstitial=function(e){if("number"!=typeof e)throw"The given ad ID is not a number.";this.id=e;var o=this;this.onFullScreenShown=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenshow",function(e,n){o.id===n[0]&&e()}),this.onFullScreenHidden=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenhide",function(e,n){o.id===n[0]&&e()}),this.onFullScreenReady=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenready",function(e,n){o.id===n[0]&&e()});var n=new Cocoon.Signal.createSignal;n.register("ready",this.onFullScreenReady),n.register("shown",this.onFullScreenShown),n.register("hidden",this.onFullScreenHidden),this.on=n.expose()},e.Interstitial.prototype={showInterstitial:function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","showFullScreen",[this.id],!0):void 0},refreshInterstitial:function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","refreshFullScreen",[this.id],!0):void 0}},e.configure=function(e){return"undefined"==typeof e&&(e={}),Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","requestInitialization",arguments,!0):void 0},e.createBanner=function(o){if("undefined"==typeof o&&(o={}),Cocoon.Ad.nativeAvailable){var n=Cocoon.callNative("IDTK_SRV_AD","createBanner",[o]),t=new e.Banner(n);return t}},e.releaseBanner=function(e){if("undefined"==typeof e)throw"The banner ad object to be released is undefined";Cocoon.Ad.nativeAvailable&&Cocoon.callNative("IDTK_SRV_AD","releaseBanner",[e.id])},e.createInterstitial=function(e){if("undefined"==typeof e&&(e={}),Cocoon.Ad.nativeAvailable){var o=Cocoon.callNative("IDTK_SRV_AD","createFullscreen",[e]),n=new Cocoon.Ad.Interstitial(o);return n}},e.releaseInterstitial=function(e){if(!e)throw"The fullscreen ad object to be released is undefined";Cocoon.Ad.nativeAvailable&&Cocoon.callNative("IDTK_SRV_AD","releaseFullscreen",[e.id])},e.showBanner=function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","showBanner",arguments,!0):void 0},e.hideBanner=function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","hideBanner",arguments,!0):void 0},e.refreshBanner=function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","refreshBanner",arguments,!0):void 0},e.showInterstitial=function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","showFullScreen",arguments,!0):void 0},e.refreshInterstitial=function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","refreshFullScreen",arguments,!0):void 0},e.preloadedBanner=!1,e.loadBanner=function(){return Cocoon.Ad.nativeAvailable?Cocoon.Ad.preloadedBanner?Cocoon.Ad.refreshBanner():(Cocoon.Ad.preloadedBanner=!0,Cocoon.callNative("IDTK_SRV_AD","preloadBanner",arguments,!0)):void 0},e.preloadedInterstitial=!1,e.loadInterstitial=function(){return Cocoon.Ad.nativeAvailable?Cocoon.Ad.preloadedInterstitial?Cocoon.Ad.refreshInterstitial():(Cocoon.Ad.preloadedInterstitial=!0,Cocoon.callNative("IDTK_SRV_AD","preloadFullScreen",arguments,!0)):void 0},e.setRectangle=function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","setRectangle",arguments):void 0},e.getRectangle=function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","getRectangle",arguments):void 0},e.setBannerLayout=function(){return Cocoon.Ad.nativeAvailable?Cocoon.callNative("IDTK_SRV_AD","setBannerLayout",arguments):void 0},e.onBannerShown=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannershow"),e.onBannerHidden=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannerhide"),e.onBannerReady=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onbannerready"),e.onFullScreenShown=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenshow"),e.onFullScreenHidden=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenhide"),e.onFullScreenReady=new Cocoon.EventHandler("IDTK_SRV_AD","Ad","onfullscreenready");var o=new Cocoon.Signal.createSignal;o.register("ready",e.onBannerReady),o.register("shown",e.onBannerShown),o.register("hidden",e.onBannerHidden),e.banner={},e.banner.on=o.expose();var o=new Cocoon.Signal.createSignal;return o.register("ready",e.onFullScreenReady),o.register("shown",e.onFullScreenShown),o.register("hidden",e.onFullScreenHidden),e.interstitial={},e.interstitial.on=o.expose(),e}),Cocoon.define("Cocoon.Store",function(e){"use strict";e.nativeAvailable=!!Cocoon.nativeAvailable&&!!window.ext.IDTK_SRV_STORE,e.ProductInfo={productId:"productId",productAlias:"productAlias",productType:"productType",title:"title",description:"description",price:"price",localizedPrice:"localizedPrice",downloadURL:"downloadURL"},e.ProductType={CONSUMABLE:0,NON_CONSUMABLE:1,AUTO_RENEWABLE_SUBSCRIPTION:2,FREE_SUBSCRIPTION:3,NON_RENEWABLE_SUBSCRIPTION:4},e.StoreType={APP_STORE:0,PLAY_STORE:1,MOCK_STORE:2,CHROME_STORE:3,AMAZON_STORE:4,NOOK_STORE:5},e.PurchaseInfo=function(e,o,n,t,i){return this.transactionId=e,this.purchaseTime=o,this.purchaseState=n,this.productId=t,this.quantity=i,this},e.PurchaseState={PURCHASED:0,CANCELED:1,REFUNDED:2,EXPIRED:3},e.getStoreType=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","getStoreType",arguments):!1},e.initialize=function(e){e=e||{},Cocoon.Store.requestInitialization(e),Cocoon.Store.start()},e.requestInitialization=function(e){return"undefined"==typeof e?e={}:(void 0!==e.managed&&(e.remote=e.managed),void 0!==e.sandbox&&(e.debug=e.sandbox)),Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","requestInitialization",arguments,!0):void 0},e.start=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","start",arguments):void 0},e.canPurchase=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","canPurchase",arguments):!1},e.fetchProductsFromServer=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","fetchProductsFromServer",arguments,!0):void 0},e.loadProducts=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","fetchProductsFromStore",arguments,!0):void 0},e.finish=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","finishPurchase",arguments,!0):void 0},e.consume=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","consumePurchase",arguments,!0):void 0},e.purchase=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","purchaseFeature",arguments,!0):void 0},e.puchaseProductModal=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","purchaseFeatureModal",arguments,!0):void 0},e.purchaseProductModalWithPreview=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","purchaseFeatureModalWithPreview",arguments,!0):void 0},e.isProductPurchased=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","isFeaturePurchased",arguments):void 0},e.restore=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","restorePurchases",arguments,!0):void 0},e.restorePurchasesModal=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","restorePurchasesModal",arguments,!0):void 0},e.getProducts=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","getProducts",arguments):void 0},e.addProduct=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","addProduct",arguments):void 0},e.removeProduct=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","removeProduct",arguments):void 0},e.getPurchases=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","getPurchases",arguments):void 0},e.addPurchase=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","addPurchase",arguments):void 0},e.removePurchase=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","removePurchase",arguments):void 0},e.cancelPurchase=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","cancelPurchase",arguments):void 0},e.refundPurchase=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","refundPurchase",arguments):void 0},e.expirePurchase=function(){return Cocoon.Store.nativeAvailable?Cocoon.callNative("IDTK_SRV_STORE","expirePurchase",arguments):void 0},e.onProductsFetchStarted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductsFetchStarted"),e.onProductsFetchCompleted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductsFetchCompleted"),e.onProductsFetchFailed=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductsFetchFailed"),e.onProductPurchaseStarted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductPurchaseStarted"),e.onProductPurchaseVerificationRequestReceived=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductPurchaseVerificationRequestReceived"),e.onProductPurchaseCompleted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductPurchaseCompleted"),e.onProductPurchaseFailed=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onProductPurchaseFailed"),e.onRestorePurchasesStarted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onRestorePurchasesStarted"),e.onRestorePurchasesCompleted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onRestorePurchasesCompleted"),e.onRestorePurchasesFailed=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onRestorePurchasesFailed"),e.onConsumePurchaseStarted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onConsumePurchaseStarted"),e.onConsumePurchaseCompleted=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onConsumePurchaseCompleted"),e.onConsumePurchaseFailed=new Cocoon.EventHandler("IDTK_SRV_STORE","Store","onConsumePurchaseFailed");var o=new Cocoon.Signal.createSignal;return o.register("load",{started:e.onProductsFetchStarted,success:e.onProductsFetchCompleted,error:e.onProductsFetchFailed}),o.register("purchase",{started:e.onProductPurchaseStarted,success:e.onProductPurchaseCompleted,verification:e.onProductPurchaseVerificationRequestReceived,error:e.onProductPurchaseFailed}),o.register("consume",{started:e.onConsumePurchaseStarted,success:e.onConsumePurchaseCompleted,error:e.onConsumePurchaseFailed}),o.register("restore",{started:e.onRestorePurchasesStarted,success:e.onRestorePurchasesCompleted,error:e.onRestorePurchasesFailed}),e.on=o.expose(),e}),Cocoon.define("Cocoon.Notification",function(e){e.nativeAvailable=!!window.ext&&!!window.ext.IDTK_SRV_NOTIFICATION,e.Local={},e.Push={},e.Local.create=function(e){var o={message:"",soundEnabled:!0,badgeNumber:0,userData:{},contentBody:"",contentTitle:"",date:(new Date).valueOf()+1e3},n=Cocoon.clone(o,e);return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","createLocalNotification",n):void 0},e.Push.create=function(e){var o={message:"",soundEnabled:!0,badgeNumber:0,userData:{},channels:[],expirationTime:0,expirationTimeInterval:0};for(var n in o)e[n]||(e[n]=o[n]);return e},e.start=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","start",arguments):void 0},e.Push.register=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","registerForPushNotifications",arguments,!0):void 0},e.Push.unregister=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","unregisterForPushNotifications",arguments,!0):void 0},e.Local.cancel=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","cancelLocalNotification",arguments):void 0},e.Local.cancelLast=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","cancelLocalNotification",arguments,!0):void 0},e.Local.cancelAllNotifications=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","cancelAllLocalNotifications",arguments):void 0},e.Local.send=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","sendLocalNotification",arguments,!0):void 0},e.subscribe=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","subscribe",arguments,!0):void 0},e.unsubscribe=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","unsubscribe",arguments,!0):void 0},e.Push.send=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","sendPushNotification",arguments,!0):void 0},e.setBadgeNumber=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","setBadgeNumber",arguments):void 0},e.getBadgeNumber=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","getBadgeNumber",arguments):void 0},e.Local.getLastNotificationData=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","getLastReceivedLocalNotificationData",arguments):void 0},e.Push.getLastNotificationData=function(){return Cocoon.Notification.nativeAvailable?Cocoon.callNative("IDTK_SRV_NOTIFICATION","getLastReceivedPushNotificationData",arguments):void 0},e.onRegisterForPushNotificationsSucceed=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationServiceRegistered"),e.onUnregisterForPushNotificationsSucceed=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationServiceUnregistered"),e.onRegisterForPushNotificationsFailed=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationServiceFailedToRegister"),e.onPushNotificationReceived=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationReceived"),e.onLocalNotificationReceived=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","localNotificationReceived"),e.onPushNotificationDeliverySucceed=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationSuccessfullyDelivered"),e.onPushNotificationDeliveryFailed=new Cocoon.EventHandler("IDTK_SRV_NOTIFICATION","Notification","pushNotificationDeliveryError");var o=new Cocoon.Signal.createSignal;o.register("notification",{received:e.onLocalNotificationReceived}),e.Local.on=o.expose();var o=new Cocoon.Signal.createSignal;return o.register("register",{success:e.onRegisterForPushNotificationsSucceed,unregister:e.onUnregisterForPushNotificationsSucceed,error:e.onRegisterForPushNotificationsFailed}),o.register("notification",{received:e.onPushNotificationReceived}),o.register("deliver",{success:e.onPushNotificationDeliverySucceed,error:e.onPushNotificationDeliveryFailed}),e.Push.on=o.expose(),e}),Cocoon.define("Cocoon.Social",function(e){return e.Interface=function(){this.onLoginStatusChanged=new Cocoon.EventHandler("","dummy","onLoginStatusChanged");var e=new Cocoon.Signal.createSignal;return e.register("loginStatusChanged",this.onLoginStatusChanged),this.on=e.expose(),this},e.Interface.prototype={isLoggedIn:function(){return!1},login:function(e){e&&e(!1,{message:"Not implemented!"})},logout:function(e){e&&e({message:"Not implemented!"})},getLoggedInUser:function(){return null},hasPublishPermissions:function(e){e(!0)},requestPublishPermissions:function(e){e&&e(!0,null)},requestUser:function(e){e(null,{message:"Not implemented!"})},requestUserImage:function(e){e("",{message:"Not implemented!"})},requestFriends:function(e){e([],{message:"Not implemented!"})},publishMessage:function(e,o){o({message:"Not implemented!"})},publishMessageWithDialog:function(e,o){o({message:"Not implemented!"})}},e.SocialGamingService=function(){return Cocoon.Social.SocialGamingService.superclass.constructor.call(this),this},e.SocialGamingService.prototype={_cachedAchievements:null,_achievementsMap:null,_leaderboardsTemplate:null,_achievementsTemplate:null,requestScore:function(e){e(null,{message:"Not implemented!"})},submitScore:function(e,o){o&&o({message:"Not implemented!"})},showLeaderboard:function(e){e&&e({message:"Not implemented!"})},requestAllAchievements:function(e){e([],{message:"Not implemented!"})},requestAchievements:function(e){e([],{message:"Not implemented!"})},submitAchievement:function(e,o){o&&o({message:"Not implemented!"})},resetAchievements:function(e){e&&e([],{message:"Not implemented!"})},showAchievements:function(e){if(!this._achievementsTemplate)throw"Please, provide a html template for achievements with the setTemplates method";var o=new Cocoon.Widget.WebDialog,n=!1;o.show(this._achievementsTemplate,function(t){o.closed=!0,!n&&e&&e(t)});var t=this;this.requestAchievements(function(i,a){if(!o.closed){if(a)return n=!0,void(e&&e(a));var r=[];if(t._cachedAchievements)for(var c=0;c<t._cachedAchievements.length;++c){var s=t._cachedAchievements[c];if(r.push(s),i&&i.length)for(var l=0;l<i.length;++l)if(i[l].achievementID===s.achievementID){s.achieved=!0;break}}var u="addAchievements("+JSON.stringify(r)+");";o.eval(u)}})},setAchievementsMap:function(e){this._achievementsMap=e,this._cachedAchievements&&this.syncAchievementsMap(this._cachedAchievements)},setTemplates:function(e,o){this._leaderboardsTemplate=e,this._achievementsTemplate=o},setCachedAchievements:function(e){this._cachedAchievements=e,e&&this._achievementsMap&&this.syncAchievementsMap(this._cachedAchievements)},findAchievement:function(e){if(!this._cachedAchievements)return null;for(var o=0;o<this._cachedAchievements.length;++o)if(e===this._cachedAchievements[o].achievementID)return this._cachedAchievements[o];return null},translateAchievementID:function(e){if(this._achievementsMap)for(var o in this._achievementsMap)if(o==e)return this._achievementsMap[o];return e},syncAchievementsMap:function(e){if(this._achievementsMap)for(var o=0;o<e.length;++o)for(var n in this._achievementsMap)this._achievementsMap[n]===e[o].achievementID&&(e[o].customID=n)}},Cocoon.extend(e.SocialGamingService,e.Interface),e.ImageSize={THUMB:"thumb",SMALL:"small",MEDIUM:"medium",LARGE:"large"},e.User=function(e,o,n){return this.userID=e,this.userName=o,this.userImage=n,this},e.Message=function(e,o,n,t,i){return this.message=e,this.mediaURL=o,this.linkURL=n,this.linkText=t,this.linkCaption=i,this},e.Score=function(e,o,n,t,i){return this.userID=e,this.score=o||0,this.userName=n,this.imageURL=t,this.leaderboardID=i,this},e.ScoreParams=function(e,o,n,t){this.userID=e,this.leaderboardID=o,this.friends=!!n,this.timeScope=t||2},e.TimeScope={ALL_TIME:0,WEEK:1,TODAY:2},e.Achievement=function(e,o,n,t,i){return this.achievementID=e,this.customID=e,this.title=o,this.description=n,this.imageURL=t,this.points=i||0,this},e.share=function(){return Cocoon.nativeAvailable?Cocoon.callNative("IDTK_APP","share",arguments,!0):void 0},e}),Cocoon.define("Cocoon.Social",function(e){return e.ManagerService=function(){this.services=[]},e.ManagerService.prototype={services:null,registerSocialService:function(e){this.services.push(e)},submitAchievement:function(e){for(var o=0;o<this.services.length;++o){var n=this.services[o];!n.readOnlyHint&&n.isLoggedIn()&&n.submitAchievement(e,function(e){e&&console.error("Error submitting achievement: "+e.message)})}},submitScore:function(e,o){for(var n=0;n<this.services.length;++n){var t=this.services[n];!t.readOnlyHint&&t.isLoggedIn()&&t.submitScore(e,function(e){e&&console.error("Error submitting score: "+e.message)},o)}},getLoggedInServices:function(){for(var e=[],o=0;o<this.services.length;++o){var n=this.services[o];!n.fakeSocialService&&n.isLoggedIn()&&e.push(n)}return e},isLoggedInAnySocialService:function(){return this.getLoggedInServices().length>0}},e.Manager=new e.ManagerService,e}),Cocoon.define("Cocoon.Social",function(e){return e.LocalStorageService=function(){Cocoon.Social.LocalStorageService.superclass.constructor.call(this),this.fakeSocialService=!0},e.LocalStorageService.prototype={loggedIn:!1,keys:{score:"Cocoon.Social.LocalStorageService.score",earnedAchievements:"Cocoon.Social.LocalStorageService.earned"},isLoggedIn:function(){return this.loggedIn},login:function(e){this.loggedIn||this.onLoginStatusChanged.notifyEventListeners(!0),this.loggedIn=!0,e&&setTimeout(function(){e(!0)},0)},logout:function(e){this.loggedIn&&this.onLoginStatusChanged.notifyEventListeners(!0),this.loggedIn=!1,e&&setTimeout(function(){e()},0)},getLoggedInUser:function(){return new Cocoon.Social.User("me","LocalStorage")},requestUser:function(e,o){var n=new Cocoon.Social.User(o||"me","LocalStorage");e&&setTimeout(function(){e(n)},0)},requestScore:function(e){var o=localStorage.getItem(this.keys.score),n=parseInt(o)||0;setTimeout(function(){e(new Cocoon.Social.Score("me",n))},0)},submitScore:function(e,o){var n=localStorage.getItem(this.keys.score),t=parseInt(n)||0;e>t&&localStorage.setItem(this.keys.score,e),o&&setTimeout(function(){o()},0)},getLocalStorageEarnedAchievements:function(){var e=localStorage.getItem(this.keys.earnedAchievements),o=[];if(e){var n=JSON.stringify(e);n&&n.length&&(o=n)}return o},requestAchievements:function(e){var o=this.getLocalStorageEarnedAchievements();setTimeout(function(){e(o)},0)},submitAchievement:function(e,o){if(null===e||"undefined"==typeof e)throw"No achievementID specified";for(var n=this.getLocalStorageEarnedAchievements(),t=!1,i=0;i<n.length;++i)if(n[i]===e){t=!0;break}t||(n.push(e),localStorage.setItem(this.keys.earnedAchievements,JSON.stringify(n))),o&&setTimeout(function(){o()},0)},resetAchievements:function(e){localStorage.removeItem(this.keys.earnedAchievements),e&&setTimeout(function(){e()},0)}},Cocoon.extend(e.LocalStorageService,e.SocialGamingService),e.LocalStorage=new e.LocalStorageService,e}),Cocoon.define("Cocoon.Social",function(e){function o(e,o){return{access_token:e.access_token,state:e.state,error:o,expires_in:e.expirationDate?e.expirationDate-Date.now():0,player_id:e.playerId}}function n(e){return new Cocoon.Social.User(e.playerId,e.displayName,e.avatarImageUrl)}function t(e){var o=e.image?e.image.url:"";return o=o.replace(/sz=\d+/g,"sz=100"),new Cocoon.Social.User(e.id,e.displayName,o)}function i(e){return e===Cocoon.Social.ImageSize.THUMB?100:e===Cocoon.Social.ImageSize.MEDIUM?200:e===Cocoon.Social.ImageSize.LARGE?512:void 0}function a(e){var o=new Cocoon.Social.Achievement(e.id,e.name,e.description,e.revealedIconUrl,0);return o.gpAchievementData=e,o}function r(e,o){return new Cocoon.Social.Score(e.player.playerId,e.scoreValue,e.player.displayName,e.player.avatarImageUrl,o)}return e.GooglePlayGamesExtension=function(){this.nativeExtensionName="IDTK_SRV_GOOGLE_PLAY_GAMES",this.extensionName="Social.GooglePlayGames",this.nativeAvailable=Cocoon.nativeAvailable&&"undefined"!=typeof window.ext[this.nativeExtensionName],this.auth=new Cocoon.Social.GooglePlayGamesAuthExtension(this),this.client=new Cocoon.Social.GooglePlayGamesClientExtension(this),this.defaultScopes=["https://www.googleapis.com/auth/games","https://www.googleapis.com/auth/plus.login"],this.gamesAPI="/games/v1",this.plusAPI="/plus/v1",this.onSessionChanged=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onSessionChanged"),Cocoon.Social.GooglePlayGames=this;var e=this;return this.onSessionChanged.addEventListener(function(n,t){e.token=o(n,t),n&&n.access_token&&e.client.request({path:e.gamesAPI+"/players/me",callback:function(o){e.currentPlayer=o}})}),this},e.GooglePlayGamesExtension.prototype={token:null,settings:{},socialService:null,currentPlayer:null,initialized:!1,auth:null,client:null,init:function(e){if(!e||"object"!=typeof e)throw"Invalid params argument";if(this.settings=e,this.initialized=!0,this.nativeAvailable)Cocoon.callNative(this.nativeExtensionName,"init",[this.settings.clientId],!0);else{var o=this,n=function(){gapi.auth.authorize({immediate:!0,scope:o.defaultScopes,client_id:o.settings.clientId},function(e){o.token=e,e&&e.access_token&&o.onSessionChanged.notifyEventListeners(e)})};if(window.gapi)n();else{window.onGapiLoadCallback=function(){window.setTimeout(n,1)};var t=document.createElement("script");t.src="https://apis.google.com/js/client.js?onload=onGapiLoadCallback",document.getElementsByTagName("head")[0].appendChild(t)}}},getSocialInterface:function(){if(!this.initialized)throw"You must call init() before getting the Social Interface";return this.socialService||(this.socialService=new Cocoon.Social.SocialGamingServiceGooglePlayGames(this)),this.socialService},getMultiplayerInterface:function(){return Cocoon.Multiplayer.GooglePlayGames},share:function(){return window.open(this.href,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600"),!1}},e.GooglePlayGamesAuthExtension=function(e){return this.extension=e,this},e.GooglePlayGamesAuthExtension.prototype={authorize:function(e,n){var t=this;this.extension.nativeAvailable?Cocoon.callNative(this.extension.nativeExtensionName,"authorize",[e,function(e,i){t.extension.token=o(e,i),n&&n(t.extension.token)}],!0):gapi.auth.authorize(e,function(e){t.extension.token=e,t.extension.onSessionChanged.notifyEventListeners(e,e?e.error:null),n&&n(e)})},disconnect:function(e){this.extension.nativeAvailable?Cocoon.callNative(this.extension.nativeExtensionName,"disconnect",[e],!0):e&&e({error:"Not implemented yet"})},init:function(e){this.extension.nativeAvailable?e():gapi.auth.init(e)},getToken:function(){return this.extension.nativeAvailable?this.extension.token:gapi.auth.getToken()},setToken:function(e){this.extension.nativeAvailable?this.extension.token=e:gapi.auth.setToken(e)}},e.GooglePlayGamesClientExtension=function(e){return this.extension=e,this},e.GooglePlayGamesClientExtension.prototype={setApiKey:function(e){this.extension.nativeAvailable?Cocoon.callNative(this.extension.nativeExtensionName,"setApiKey",[e],!0):gapi.client.setApiKey(e)},request:function(e){if(this.extension.nativeAvailable){if(e.callback)return Cocoon.callNative(this.extension.nativeExtensionName,"request",[e,function(o,n){var t=o;n&&(t=o||{},t.error=n),e.callback(t)}],!0),null;var o=this,n={execute:function(n){Cocoon.callNative(o.extension.nativeExtensionName,"request",[e,function(e,o){var t=e;o&&(t=e||{},t.error=o),n(t)}],!0)}};return n}return gapi.client.request(e)}},e.GooglePlayGames=new Cocoon.Social.GooglePlayGamesExtension,e.SocialGamingServiceGooglePlayGames=function(e){Cocoon.Social.SocialGamingServiceGooglePlayGames.superclass.constructor.call(this),this.gapi=e;var o=this;return this.gapi.onSessionChanged.addEventListener(function(e){var n=e||{};o.onLoginStatusChanged.notifyEventListeners(!!n.access_token,n.error)}),this},e.SocialGamingServiceGooglePlayGames.prototype={isLoggedIn:function(){return this.gapi.token&&this.gapi.token.access_token?!0:!1},login:function(e){var o=this;this.gapi.auth.authorize({client_id:this.gapi.settings.clientId,scope:this.gapi.defaultScopes},function(n){e&&e(o.isLoggedIn(),n.error)})},logout:function(e){this.gapi.auth.disconnect(e)},getLoggedInUser:function(){return this.gapi.currentPlayer?fromGPUserToCocoonUser(this.gapi.currentPlayer):null},requestUser:function(e,o){var t=o||"me";this.gapi.client.request({path:this.gapi.gamesAPI+"/players/"+t,callback:function(o){var t=o&&!o.error?n(o):null;e(t,o.error)}})},requestUserImage:function(e,o,n){this.requestUser(function(o,t){if(o&&o.userImage){var a=i(n||Cocoon.Social.ImageSize.MEDIUM);-1===o.userImage.indexOf("sz=")?o.userImage+="?sz="+a:o.userImage=o.userImage.replace(/sz=\d+/g,"sz="+a)}e(o?o.userImage:null,t)},o)},requestFriends:function(e,o){var n={orderBy:"best"},i=o||"me";this.gapi.client.request({path:this.gapi.plusAPI+"/people/"+i+"/people/visible",params:n,callback:function(o){if(o&&!o.error){for(var n=[],i=0;i<o.items.length;++i)n.push(t(o.items[i]));e(n)}else e([],o?o.error:null)}})},publishMessage:function(e,o){o&&o("Not supported... use publishMessageWithDialog method instead")},publishMessageWithDialog:function(e,o){if(this.gapi.nativeAvailable){var n={prefilledText:e.message,mediaUrl:e.mediaURL,mediaTitle:e.linkCaption,mediaDescription:e.linkText,url:e.linkURL};Cocoon.callNative(this.gapi.nativeExtensionName,"shareMessage",[n,o],!0)}else{var t=this,i=function(){var o={contenturl:"https://plus.google.com/pages/",contentdeeplinkid:"/pages",clientid:t.gapi.settings.clientId,cookiepolicy:"single_host_origin",prefilltext:e.message,calltoactionlabel:"CREATE",calltoactionurl:"http://plus.google.com/pages/create",calltoactiondeeplinkid:"/pages/create"};gapi.interactivepost.render("sharePost",o)};if(gapi.interactivepost)i();else{var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src="https://apis.google.com/js/plusone.js",a.onload=function(){i()},document.getElementsByTagName("head")[0].appendChild(a)}}},requestScore:function(e,o){o=o||{};var n=o.userID||"me",t=o.leaderboardID||this.gapi.settings.defaultLeaderboard;if(!t)throw"leaderboardID not provided in the params. You can also set the default leaderboard in the init method";this.gapi.client.request({path:this.gapi.gamesAPI+"/players/"+n+"/leaderboards/"+t+"/scores/ALL_TIME",callback:function(o){if(o&&o.error)e(null,o.error);else if(o&&o.items&&o.items.length>0){var t=o.items[0],i=new Cocoon.Social.Score(n,t.scoreValue,"","",t.leaderboard_id);e(i,null)}else e(null,null)}})},submitScore:function(e,o,n){n=n||{};var t=n.leaderboardID||this.gapi.settings.defaultLeaderboard;if(!t)throw"leaderboardID not provided in the params. You can also set the default leaderboard in the init method";this.gapi.client.request({path:this.gapi.gamesAPI+"/leaderboards/"+t+"/scores",method:"POST",params:{score:e},callback:function(e){o&&o(e?e.error:null)}})},showLeaderboard:function(e,o){o=o||{};var n=o.leaderboardID||this.gapi.settings.defaultLeaderboard;if(!n)throw"leaderboardID not provided in the params. You can also set the default leaderboard in the init method";var t=/(iPad|iPhone|iPod)/gi.test(navigator.userAgent);
if(!t&&this.gapi.nativeAvailable){var i=o.timeScope||0;Cocoon.callNative(this.gapi.nativeExtensionName,"showLeaderboard",[n,i,e],!0)}else{if(!this._leaderboardsTemplate)throw"Please, provide a html template for leaderboards with the setTemplates method";var a=new Cocoon.Widget.WebDialog,c=!1;a.show(this._leaderboardsTemplate,function(o){a.closed=!0,!c&&e&&e(o)});var s=o.friends?"SOCIAL":"PUBLIC",l="ALL_TIME";o.timeScope===Cocoon.Social.TimeScope.WEEK?l="WEEKLY":o.timeScope===Cocoon.Social.TimeScope.TODAY&&(l="DAILY"),this.gapi.client.request({path:this.gapi.gamesAPI+"/leaderboards/"+n+"/window/"+s,method:"GET",params:{timeSpan:l},callback:function(o){if(!a.closed){if(o.error)return void(e&&(c=!0,e(o.error),a.close()));var t=[],i=[];o&&o.items&&(i=o.items.slice(0)),o&&o.playerScore&&i.push(o.playerScore);for(var s=0;s<i.length;++s){var l=i[s],u=r(l,n);u.imageURL+="?sz=50",u.position=l.scoreRank||s+1,u.me=!1,t.push(u)}var d="addScores("+JSON.stringify(t)+")";a.eval(d)}}})}},prepareAchievements:function(e,o){if(!this._cachedAchievements||e){var n=this;this.gapi.client.request({path:this.gapi.gamesAPI+"/achievements",callback:function(e){if(e&&!e.error){var t=[];if(e&&e.items)for(var i=0;i<e.items.length;i++)t.push(a(e.items[i]));n.setCachedAchievements(t),o(t,null)}else o([],e?e.error:null)}})}else o(this._cachedAchievements,null)},requestAllAchievements:function(e){this.prepareAchievements(!0,e)},requestAchievements:function(e,o){var n=this;this.prepareAchievements(!1,function(t,i){if(i)return void e([],i);var a=o||"me";n.gapi.client.request({path:n.gapi.gamesAPI+"/players/"+a+"/achievements",params:{state:"UNLOCKED"},callback:function(o){if(o&&!o.error){var t=[];if(o.items)for(var i=0;i<o.items.length;i++){var a=n.findAchievement(o.items[i].id);a&&t.push(a)}e(t,null)}else e([],o?o.error:null)}})})},submitAchievement:function(e,o){if(null===e||"undefined"==typeof e)throw"No achievementID specified";var n=this.translateAchievementID(e);if(this.gapi.nativeAvailable){var t=!!this.gapi.settings.showAchievementNotifications;Cocoon.callNative(this.gapi.nativeExtensionName,"unlockAchievement",[n,t,o],!0)}else this.gapi.client.request({path:this.gapi.gamesAPI+"/achievements/"+n+"/unlock",method:"POST",callback:function(e){o&&o(e?e.error:null)}})},resetAchievements:function(e){this.gapi.client.request({path:"/games/v1management/achievements/reset",method:"POST",callback:function(o){e&&e(o?o.error:null)}})},showAchievements:function(e){var o=/(iPad|iPhone|iPod)/gi.test(navigator.userAgent);!o&&this.gapi.nativeAvailable?Cocoon.callNative(this.gapi.nativeExtensionName,"showAchievements",[e],!0):Cocoon.Social.SocialGamingServiceGooglePlayGames.superclass.showAchievements.call(this)}},Cocoon.extend(Cocoon.Social.SocialGamingServiceGooglePlayGames,Cocoon.Social.SocialGamingService),e}),Cocoon.define("Cocoon.Social",function(e){function o(e){return new Cocoon.Social.User(e.playerID,e.alias)}function n(e){return new Cocoon.Social.GameCenter.Achievement(e.identifier,e.title,e.achievedDescription,"",e.maximumPoints)}return e.GameCenterExtension=function(){this.nativeExtensionName="IDTK_SRV_GAMECENTER",this.extensionName="Social.GameCenter",this.nativeAvailable=!!window.ext&&!!window.ext[this.nativeExtensionName];var e=this;return this.nativeAvailable&&(this.onGameCenterLoginStateChanged=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onGameCenterLoginStateChanged"),this.onGameCenterLoginStateChanged.addEventListener(function(o){e._currentPlayer=o})),this},e.GameCenterExtension.prototype={_currentPlayer:null,getSocialInterface:function(){return this._socialService||(this._socialService=new Cocoon.Social.SocialGamingServiceGameCenter(this)),this._socialService},getMultiplayerInterface:function(){return Cocoon.Multiplayer.GameCenter},isLoggedIn:function(){return this._currentPlayer&&this._currentPlayer.isAuthenticated},login:function(e){var o=this;if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"login",[function(n,t){o._currentPlayer=n,e&&e(n,t)}],!0)},getLocalPlayer:function(){if(this._currentPlayer)return this._currentPlayer;if(this.nativeAvailable)return this._currentPlayer=Cocoon.callNative(this.nativeExtensionName,"getLocalPlayer",[]),this._currentPlayer;throw"Game Center not available"},loadPlayers:function(e,o){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"loadPlayers",[e,o],!0)},loadFriends:function(e){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"loadFriends",[e],!0)},loadAchievements:function(e){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"loadAchievements",[e],!0)},loadAchievementDescriptions:function(e){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"loadAchievementDescriptions",[e],!0)},loadScores:function(e,o){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"loadScores",[o,e],!0)},submitScore:function(e,o){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"submitScore",[e,o],!0)},submitAchievements:function(e,o){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"submitAchievements",[e,o],!0)},resetAchievements:function(e){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"resetAchievements",[e],!0)},showAchievements:function(e){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"showAchievements",[e],!0)},showLeaderboards:function(e,o){if(!this.nativeAvailable)throw"Game Center not available";Cocoon.callNative(this.nativeExtensionName,"showLeaderboards",[o,e],!0)}},e.GameCenter=new e.GameCenterExtension,e.GameCenter.Player=function(){this.playerID="",this.alias="",this.isFriend=!1},e.GameCenter.LocalPlayer=function(){this.playerID="",this.alias="",this.isAuthenticated=!1},e.GameCenter.Achievement=function(e,o){this.identifier=e,this.percentComplete=o,this.lastReportedDate=0},e.GameCenter.AchievementDescription=function(){this.identifier="",this.title="",this.achievedDescription="",this.unachievedDescription="",this.maximumPoints=0},e.GameCenter.Score=function(e,o,n,t,i,a){return this.userID=e,this.score=o||0,this.userName=n,this.imageURL=t,this.leaderboardID=i,this.rank=a.rank,this.originalScoreObject=a,this},e.GameCenter.Leaderboard=function(e,o,n,t,i,a){this.category=e,this.playerIDs=o,this.timeScope=n,this.playerScope=t,this.rangeStart=i,this.rangeLength=a,this.scores=[],this.localPlayerScore=[],this.localizedTitle=localizedTitle},e.GameCenter.TimeScope={TODAY:0,WEEK:1,ALL_TIME:2},e.GameCenter.PlayerScope={GLOBAL:0,FRIENDS:1},e.SocialGamingServiceGameCenter=function(e){Cocoon.Social.SocialGamingServiceGameCenter.superclass.constructor.call(this),this.gc=e;var o=this;return this.gc.onGameCenterLoginStateChanged.addEventListener(function(e,n){o.onLoginStatusChanged.notifyEventListeners(e.isAuthenticated,n)}),this},e.SocialGamingServiceGameCenter.prototype={_cachedAchievements:null,isLoggedIn:function(){return this.gc.isLoggedIn()},login:function(e){this.gc.login(function(o,n){e&&e(o.isAuthenticated,n)})},logout:function(e){e&&e({message:"User has to logout from the Game Center APP"})},getLoggedInUser:function(){return o(this.gc._currentPlayer?this.gc._currentPlayer:this.gc.getLocalPlayer())},requestUser:function(e,n){if(n)this.gc.loadPlayers([n],function(n,t){var i=n&&n.length?o(n[0]):null;e(i,t)});else{var t=this;setTimeout(function(){e(t.getLoggedInUser())})}},requestFriends:function(e){this.gc.loadFriends(function(n,t){var i=[];if(n&&n.length)for(var a=0;a<n.length;++a)i.push(o(n[a]));e(i,t)})},requestScore:function(e,o){var n={},t=o||{};t.leaderboardID&&(n.category=t.leaderboardID),n.playerIDs=[t.userID||this.getLoggedInUser().userID],this.gc.loadScores(function(o,n){var i=null;t.userID&&o&&o.scores&&o.scores.length?i=o.scores[0]:o&&o.localPlayerScore&&(i=o.localPlayerScore);var a=i?new Cocoon.Social.GameCenter.Score(i.playerID,i.value,"","",i.category,i):null;e(a,n)},n)},submitScore:function(e,o,n){var t=n||{};this.gc.submitScore({value:e,category:t.leaderboardID||""},function(e){o&&o(e)})},showLeaderboard:function(e,o){var n=o||{};this.gc.showLeaderboards(function(o){e&&e(o)},{category:n.leaderboardID||""})},prepareAchievements:function(e,o){if(!this._cachedAchievements||e){var t=this;this.gc.loadAchievementDescriptions(function(e,i){if(i)o([],i);else{var a=[];if(e&&e.length)for(var r=0;r<e.length;r++)a.push(n(e[r]));t.setCachedAchievements(a),o(a,null)}})}else o(this._cachedAchievements,null)},requestAllAchievements:function(e){this.prepareAchievements(!0,e)},requestAchievements:function(e){var o=this;this.prepareAchievements(!1,function(n,t){return t?void e([],t):void o.gc.loadAchievements(function(n,t){if(t)e([],n.error);else{var i=[];if(n&&n.length)for(var a=0;a<n.length;a++){var r=o.findAchievement(n[a].identifier);r&&i.push(r)}e(i,null)}})})},submitAchievement:function(e,o){if(null===e||"undefined"==typeof e)throw"No achievementID specified";var n=this.translateAchievementID(e);this.gc.submitAchievements([{identifier:n,percentComplete:100}],o)},resetAchievements:function(e){this.gc.resetAchievements(e)},showAchievements:function(e){this.gc.showAchievements(function(o){e&&e(o)})}},Cocoon.extend(e.SocialGamingServiceGameCenter,e.SocialGamingService),e}),Cocoon.define("Cocoon.Social",function(e){function o(e){return 0===e?"connected":1===e?"not_authorized":"unknown"}function n(e,n){var t=null;return 0===e.state&&(t={accessToken:e.accessToken,expirationDate:e.expirationDate,userID:e.user?e.userID:null,permissions:e.permissions,user:e.user}),{status:o(e.state),authResponse:t,error:n}}function t(e){return new Cocoon.Social.User(e.id,e.username?e.username:e.first_name+" "+e.last_name)}function i(e){return{link:e.linkURL,description:e.message,name:e.linkText,caption:e.linkCaption,picture:e.mediaURL}}function a(e,o){var n=new Cocoon.Social.Score(e.user.id,e.score,e.user.name);return o&&(n.leaderboardID=o.leaderboardID),n.imageURL="https://graph.facebook.com/"+e.user.id+"/picture",n}function r(e){var o=new Cocoon.Social.Achievement(e.id,e.title,e.description,e.image[0].url,e.data.points);return o.fbAchievementData=e,o}if(e.FacebookExtension=function(){this.nativeExtensionName="IDTK_SRV_FACEBOOK",this.extensionName="Social.Facebook",this.nativeAvailable=!!window.ext&&!!window.ext[this.nativeExtensionName],this.Event=new Cocoon.Social.FacebookEvent(this.nativeAvailable);var e=this;return this.nativeAvailable&&(this.onFacebookSessionStateChanged=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onFacebookSessionStateChanged"),Cocoon.Social.Facebook=this,this.onFacebookSessionStateChanged.addEventListener(function(o,t){var i=n(o,t);0==o.state&&e.Event.notify("auth.login",i),e.Event.notify("auth.authResponseChange",i),e.Event.notify("auth.statusChange",i)})),this},e.FacebookExtension.prototype={_currentSession:null,_appId:null,_socialService:null,init:function(e){if(!e||!e.appId)throw"appId must be specified!";this._appId=e.appId,this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"init",[e],!0):FB.init(e);var o=this;this.Event.subscribe("auth.authResponseChange",function(e){o._currentSession=e,e.authResponse&&!e.authResponse.user&&o.api("me?fields=username",function(e){o._currentSession.authResponse.user=e})})},getSocialInterface:function(){if(!this._appId)throw"You must call init() before getting the Social Interface";return this._socialService||(this._socialService=new Cocoon.Social.SocialGamingServiceFacebook(this)),this._socialService},login:function(e,o){var t=this;this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"login",[o,function(o,i){t._currentSession=n(o,i),e&&e(t._currentSession)}],!0):FB.login(function(o){t._currentSession=o,e&&e(o)},o)},logout:function(e){this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"logout",[function(o,t){e&&e(n(o,t))}],!0):FB.logout(function(o){e&&e(o)})},getAuthResponse:function(){if(this.nativeAvailable){var e=Cocoon.callNative(this.nativeExtensionName,"getFacebookSession",[]);return n(e)}return FB.getAuthResponse()},getLoginStatus:function(e,o){if(this.nativeAvailable){var t=this;setTimeout(function(){var o=Cocoon.callNative(t.nativeExtensionName,"getFacebookSession",[]);e&&e(n(o))},50)}else FB.getLoginStatus(e,o)},api:function(e,o,n,t){if(this.nativeAvailable){var i=arguments[0],a=arguments.length>3?arguments[1]:"GET",r=null;3==arguments.length&&(r=arguments[1]),4==arguments.length&&(r=arguments[2]);var c=arguments.length>1?arguments[arguments.length-1]:function(){};return Cocoon.callNative(this.nativeExtensionName,"api",[i,a,r,c],!0)}FB.api(e,o,n,t)},ui:function(e,o){if(this.nativeAvailable){var e=arguments[0],n=arguments.length>1?arguments[1]:function(){};return Cocoon.callNative(this.nativeExtensionName,"ui",[e,n],!0)}navigator.isCocoonJS||FB.ui(e,o)},requestAdditionalPermissions:function(e,o,t){if(this.nativeAvailable){var i=o.split(",");Cocoon.callNative(this.nativeExtensionName,"requestAdditionalPermissions",[e,i,function(e,o){t&&t(n(e,o))}],!0)}else FB.login(t,{scope:o})},getPermissions:function(e){this.api("me/permissions",function(o){for(var n={},t=o&&o.data?o.data:[],i=0;i<t.length;++i)"granted"===t[i].status&&(n[t[i].permission]=!0);e(n)})},showShareDialog:function(e,o){this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"showShareDialog",[e,o],!0):(e.method="feed",FB.ui(e,o))},uploadPhoto:function(e,o){this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"uploadPhoto",[e,o],!0):o({error:{message:"Not implemented"}})},showFriendPicker:function(e){this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"showFriendPicker",[e],!0):e({error:{message:"Not implemented"}})}},e.FacebookEvent=function(e){return this.nativeAvailable=e,this},e.FacebookEvent.prototype={subscribe:function(e,o){if(this.nativeAvailable){var n=e+"listeners";this[n]=this[n]||[],this[n].push(o)}else navigator.isCocoonJS||FB.Event.subscribe(e,o)},unsubscribe:function(e,o){if(this.nativeAvailable){var n=e+"listeners",t=this[n];if(t){var i=t.indexOf(o);-1!==i&&t.splice(i,1)}}else navigator.isCocoonJS||FB.Event.unsubscribe(e,o)},notify:function(e,o){var n=e+"listeners",t=this[n];if(t)for(var i=0;i<t.length;++i)t[i](o)}},e.Facebook=new e.FacebookExtension,e.SocialGamingServiceFacebook=function(e){Cocoon.Social.SocialGamingServiceFacebook.superclass.constructor.call(this),this.fb=e;var o=this;return this.fb.Event.subscribe("auth.authResponseChange",function(e){o.onLoginStatusChanged.notifyEventListeners("connected"==e.status,e.error)}),this},e.SocialGamingServiceFacebook.prototype={currentPermissions:null,isLoggedIn:function(){return this.fb._currentSession&&"connected"===this.fb._currentSession.status},login:function(e,o){var n=this;this.fb.login(function(o){e&&e(n.isLoggedIn(),o.error)},o)},logout:function(e){this.fb.logout(function(o){e&&e(o.error)})},getLoggedInUser:function(){var e=this.fb._currentSession?this.fb._currentSession.authResponse:null;return e&&e.user?t(e.user):e&&e.userID?new Cocoon.Social.Facebook.User(e.userID,"Loading..."):null},hasPublishPermissions:function(e){this.fb.getPermissions(function(o,n){e(o.publish_actions,n)})},requestPublishPermissions:function(e){var o=this;this.fb.requestAdditionalPermissions("publish","publish_actions",function(n){n.error?e(!1,error):o.hasPublishPermissions(function(o,n){e(o,n)})})},requestUser:function(e,o){var n=o||"me";this.fb.api(n,function(o){var n=o.error?null:t(o);e(n,o.error)})},requestUserImage:function(e,o,n){!o&&this.isLoggedIn()&&(o=this.fb._currentSession.authResponse.userID);var t="small";n===Cocoon.Social.ImageSize.THUMB?t="square":n===Cocoon.Social.ImageSize.MEDIUM?t="normal":n===Cocoon.Social.ImageSize.LARGE&&(t="large");var i="https://graph.facebook.com/"+o+"/picture?type="+t;e(i)},requestFriends:function(e,o){var n=(o||"me")+"/friends";this.fb.api(n,function(o){var n=[];if(!o.error)for(var i=0;i<o.data.length;i++)n.push(t(o.data[i]));e(n,o.error)})},preparePublishAction:function(e){if(this.currentPermissions)if(this.currentPermissions.publish_actions)e(!0);else{this.currentPermissions=this.currentPermissions|{};var o=this;this.fb.requestAdditionalPermissions("publish","publish_actions",function(n){for(var t=n&&n.authResponse?n.authResponse.permissions:[],i=0;i<t.length;++i)o.currentPermissions[t[i]]=!0;e(n.error?!1:!0)})}else{var o=this;this.fb.getPermissions(function(n){o.currentPermissions=n,n?o.preparePublishAction(e):e(!1)})}},publishMessage:function(e,o){this.preparePublishAction(function(n){if(n){var t=i(e),a="me/feed";this.fb.api(a,t,function(e){o&&o(e.error)})}else o&&o({message:"No publish_actions permission granted"})})},publishMessageWithDialog:function(e,o){this.fb.showShareDialog(i(e),function(e){o&&o(e.error)})},requestScore:function(e,o){var n=(o&&o.userID?o.userID:"me")+"/scores";this.fb.api(n,function(o){if(o.error)e(null,o.error);else if(o.data&&o.data.length>0){var n=a(o.data[0]);e(n,null)}else e(null,null)})},submitScore:function(e,o,n){var t=this;this.preparePublishAction(function(i){i?t.requestScore(function(i,a){if(a)return void(o&&o(a));var r=i?i.score:0;if(r>=e)return void(o&&o(null));var c="/"+(n&&n.userID?n.userID:"me")+"/scores";t.fb.api(c,"POST",{score:e},function(e){o&&o(e.error)})},n):o&&o({message:"No publish_actions permission granted"})})},showLeaderboard:function(e){if(!this._leaderboardsTemplate)throw"Please, provide a html template for leaderboards with the setTemplates method";var o=new Cocoon.Widget.WebDialog,n=!1;o.show(this._leaderboardsTemplate,function(t){o.closed=!0,!n&&e&&e(t)});var t=this;this.fb.api(t.fb._appId+"/scores",function(i){if(!o.closed){if(i.error)return void(e&&(n=!0,e(i.error),o.close()));var r=[];if(i.data&&i.data.length)for(var c=0;c<i.data.length;++c){var s=a(i.data[c]);s.position=c,s.imageURL="https://graph.facebook.com/"+s.userID+"/picture",s.me=s.userID===t.fb._currentSession.authResponse.userID,r.push(s)}var l="addScores("+JSON.stringify(r)+")";o.eval(l)}})},prepareAchievements:function(e,o){if(!this._cachedAchievements||e){var n=this;this.fb.api(this.fb._appId+"/achievements",function(e){if(e.error)o([],e.error);else{var t=[];if(e.data)for(var i=0;i<e.data.length;i++)t.push(r(e.data[i]));n.setCachedAchievements(t),o(t,null)}})}else o(this._cachedAchievements,null)},requestAllAchievements:function(e){this.prepareAchievements(!0,e)},requestAchievements:function(e,o){var n=this;this.prepareAchievements(!1,function(t,i){if(i)return void e([],i);var a=(o||"me")+"/achievements";n.fb.api(a,function(o){if(o.error)e([],o.error);else{var t=[];if(o.data)for(var i=0;i<o.data.length;i++){var a=n.findAchievement((o.data[i].achievement||o.data[i].data.achievement).id);a&&t.push(a)}e(t,null)}})})},submitAchievement:function(e,o){if(null===e||"undefined"==typeof e)throw"No achievementID specified";var n=this.translateAchievementID(e),t=this;this.preparePublishAction(function(e){e?t.fb.api("me/achievements","POST",{achievement:n},function(e){o&&o(e.error)}):o&&o({message:"No publish_actions permission granted"})})},resetAchievements:function(e){var o=this;this.preparePublishAction(function(n){n?o.requestAchievements(function(n,t){if(t)return void(e&&e(t));for(var i=null,a=n.length,r=0;r<n.length;++r)o.fb.api("me/achievements","DELETE",{achievement:n[r].fbAchievementData.url},function(o){o.error&&(i=o.error),a--,0==a&&e&&e(i)})}):e&&e({message:"No publish_actions permission granted"})})},showAchievements:function(e){if(!this._achievementsTemplate)throw"Please, provide a html template for achievements with the setTemplates method";var o=new Cocoon.Widget.WebDialog,n=!1;o.show(this._achievementsTemplate,function(t){o.closed=!0,!n&&e&&e(t)});var t=this;this.requestAchievements(function(i,a){if(!o.closed){if(a)return n=!0,void(e&&e(a));var r=[];if(t._cachedAchievements)for(var c=0;c<t._cachedAchievements.length;++c){var s=t._cachedAchievements[c];if(r.push(s),i&&i.length)for(var l=0;l<i.length;++l)if(i[l].achievementID===s.achievementID){s.achieved=!0;break}}var u="addAchievements("+JSON.stringify(r)+");";o.eval(u)}})}},Cocoon.extend(e.SocialGamingServiceFacebook,e.SocialGamingService),!(navigator.isCocoonJS||"undefined"!=typeof module&&module.exports)){var c=document.getElementsByTagName("script")[0],s=document.createElement("script"),l=location.protocol?location.protocol:"http:";s.src=l+"//connect.facebook.net/en_US/all.js",c.parentNode.insertBefore(s,c)}return e}),Cocoon.define("Cocoon.Multiplayer",function(e){return e.MultiplayerService=function(e,o){this.nativeExtensionName=e,this.extensionName=o,this.nativeAvailable=!!window.ext&&!!window.ext[this.nativeExtensionName];var n=this;this.onInvitationReceived=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onInvitationReceived"),this.onInvitationLoaded=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onInvitationLoaded",function(e,o){var t=o[0],i=o[1];t&&!i?(n.currentMatch=new Cocoon.Multiplayer.Match(n.nativeExtensionName,n.extensionName,t),e(n.currentMatch,null)):e(null,i)});var t=new Cocoon.Signal.createSignal;return t.register("invitation",{received:this.onInvitationReceived,loaded:this.onInvitationLoaded}),this.on=t.expose(),this},e.MultiplayerService.prototype={currentMatch:null,findMatch:function(e,o){var n=this;this.nativeAvailable&&Cocoon.callNative(this.nativeExtensionName,"findMatch",[e,function(e,t){e&&!t?(n.currentMatch=new Cocoon.Multiplayer.Match(n.nativeExtensionName,n.extensionName,e),o(n.currentMatch,null)):o(null,t)}],!0)},findAutoMatch:function(e,o){var n=this;this.nativeAvailable&&Cocoon.callNative(this.nativeExtensionName,"findAutoMatch",[e,function(e,t){e&&!t?(n.currentMatch=new Cocoon.Multiplayer.Match(n.nativeExtensionName,n.extensionName,e),o(n.currentMatch,null)):o(null,t)}],!0)},cancelAutoMatch:function(){this.nativeAvailable&&Cocoon.callNative(this.nativeExtensionName,"cancelAutoMatch",[],!0)},addPlayersToMatch:function(e,o,n){this.nativeAvailable&&Cocoon.callNative(this.nativeExtensionName,"addPlayersToMatch",[e,o.matchID,n],!0)},getMatch:function(){return this.currentMatch}},e.Match=function(e,o,n){if("string"!=typeof e)throw"The given native extension name '"+e+"' is not a string.";if("string"!=typeof o)throw"The given extension name '"+e+"' is not a string.";this.nativeExtensionName=e,this.extensionName=o,this.nativeAvailable=Cocoon.nativeAvailable&&"undefined"!=typeof window.ext[e],this.matchID=n;var t=this;this.onMatchDataReceived=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onMatchDataReceived",function(e,o){t.matchID===o[0]&&e(t,o[1],o[2])}),this.onMatchStateChanged=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onMatchStateChanged",function(e,o){t.matchID===o[0]&&e(t,o[1],o[2])}),this.onMatchConnectionWithPlayerFailed=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onMatchConnectionWithPlayerFailed",function(e,o){t.matchID===o[0]&&e(t,o[1],o[2])}),this.onMatchFailed=new Cocoon.EventHandler(this.nativeExtensionName,this.extensionName,"onMatchFailed",function(e,o){t.matchID===o[0]&&e(t,o[1])});var i=new Cocoon.Signal.createSignal;i.register("match",{dataReceived:this.onMatchDataReceived,stateChanged:this.onMatchStateChanged,connectionWithPlayerFailed:this.onMatchConnectionWithPlayerFailed,failed:this.onMatchFailed}),this.on=i.expose()},e.Match.prototype={start:function(){this.nativeAvailable&&Cocoon.callNative(this.nativeExtensionName,"startMatch",[this.matchID],!0)},sendDataToAllPlayers:function(e,o){return this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"sendDataToAllPlayers",[this.matchID,e,o]):void 0},sendData:function(e,o,n){return this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"sendData",[this.matchID,e,o,n]):void 0},disconnect:function(){return this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"disconnect",[this.matchID],!0):void 0},requestPlayersInfo:function(e){return this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"requestPlayersInfo",[this.matchID,e],!0):void 0},getExpectedPlayerCount:function(){return this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"getExpectedPlayerCount",[this.matchID]):void 0},getPlayerIDs:function(){return this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"getPlayerIDs",[this.matchID]):void 0},getLocalPlayerID:function(){return this.nativeAvailable?Cocoon.callNative(this.nativeExtensionName,"getLocalPlayerID",[this.matchID]):""}},e.SendDataMode={RELIABLE:0,UNRELIABLE:1},e.ConnectionState={UNKNOWN:0,CONNECTED:1,DISCONNECTED:2},e.PlayerInfo=function(e,o){this.userID=e,this.userName=o},e.MatchRequest=function(e,o,n,t,i){return this.minPlayers=e,this.maxPlayers=o,this.playersToInvite=n,this.playerGroup=t,this.playerAttributes=i,this},e}),Cocoon.define("Cocoon.Multiplayer",function(e){var o=[],n=0,t=[],i=0;e.LoopbackService=function(){Cocoon.Multiplayer.LoopbackService.superclass.constructor.call(this,"dummy","dummy"),o.push(this),this.playerID=""+n,n++},e.LoopbackService.prototype={findMatch:function(e,o){this.findMatchCallback=o;for(var n=!1,i=0;i<t.length;++i)if(t[i]===this){n=!0;break}if(n||t.push(this),t.length>=e.minPlayers){for(var r=[],i=0;i<t.length;++i)r.push(t[i].getPlayerID());for(var i=0;i<t.length;++i){var c=new a(t[i]);c.playerIDs=r.slice(),t[i].currentMatch=c,t[i].findMatchCallback(c,null)}t=[]}},findAutoMatch:function(e,o){this.findMatch(e,o)},cancelAutoMatch:function(){},addPlayersToMatch:function(e,o,n){n({message:"Not implemmented"})},getPlayerID:function(){return this.playerID},getMatch:function(){return this.currentMatch}},Cocoon.extend(e.LoopbackService,e.MultiplayerService);var a=function(e){i++,a.superclass.constructor.call(this,"","",i),this.started=!1,this.disconnected=!1,this.pendingData=[],this.service=e};return a.prototype={start:function(){var e=this;setTimeout(function(){e.started=!0;for(var o=0;o<e.pendingData.length;++o)e.onMatchDataReceived.notifyEventListeners(e.matchID,e.pendingData[o].data,e.pendingData[o].player)},0)},sendDataToAllPlayers:function(e,o){this.sendData(e,this.playerIDs,o)},sendData:function(e,n){var t=this;setTimeout(function(){for(var i=0;i<o.length;++i){for(var a=null,r=0;r<n.length;++r)n[r]===o[i].getPlayerID()&&(a=o[i]);a&&a.getMatch().notifyDataReceived(e,t.service.getPlayerID())}},0)},disconnect:function(){this.disconnected=!0;for(var e=0;e<this.playerIDs.length;++e)for(var n=this.playerIDs[e],t=0;t<o.length;++t)if(o[t].getPlayerID()===n){var i=o[e].getMatch();i.disconnected||i.onMatchStateChanged.notifyEventListeners(i,this.service.getPlayerID(),Cocoon.Multiplayer.ConnectionState.DISCONNECTED)}},requestPlayersInfo:function(e){var o=this;setTimeout(function(){for(var n=[],t=0;t<o.playerIDs.length;++t)n[t]={userID:o.playerIDs[t],userName:"Player"+o.playerIDs[t]};e(n)},1)},getExpectedPlayerCount:function(){return 0},getPlayerIDs:function(){return this.playerIDs},getLocalPlayerID:function(){return this.service.playerID},notifyDataReceived:function(e,o){this.started?this.onMatchDataReceived.notifyEventListeners(this.matchID,e,o):this.pendingData.push({data:e,player:o})}},Cocoon.extend(a,Cocoon.Multiplayer.Match),e}),Cocoon.define("Cocoon.Multiplayer",function(e){return e.GooglePlayGames=new Cocoon.Multiplayer.MultiplayerService("IDTK_SRV_MULTIPLAYER_GPG","Multiplayer.GooglePlayGames"),e}),Cocoon.define("Cocoon.Multiplayer",function(e){return e.GameCenter=new Cocoon.Multiplayer.MultiplayerService("IDTK_SRV_MULTIPLAYER_GAMECENTER","Multiplayer.GameCenter"),e});